{% extends "base.html.twig" %}

{% block title %}Forum - {{ subject.title }}{% endblock %}

{% block body %}
    <style>
        .message__form--hidden {
            display:none;
        }
    </style>
    <main>
        <section class="topic__top">
            <p class="topic__top__nav"><a href="{{ path('app_home') }}">Accueil</a> > <a href="{{ path('app_forum_list') }}">Forum</a> > <a href="{{ path('app_cat_show', { 'id': catId }) }}">{{ catTitle }}</a> > <a href="{{ path('app_sub_show', { 'catId': catId, 'id': subId }) }}">{{ subTitle }}</a> > {{ subject.title }}</p>
            <div class="topic__top__nav__sub">
                <h1>{{ subject.title }}</h1>
                {% if subject.subTitle %}
                    <h2>{{ subject.subTitle }}</h2>
                {% endif %}
            </div>
            <div class="topic__top__nav__cont">
            <div class="topic__top__nav__cont__line"></div>
        </div>
        </section>

        <section class="topic__pagination">
            <div class="navigation topic__pagination__nav">
                {{ knp_pagination_render(responses) }}
            </div>
        </section>

        <section class="topic__subjectCont">
            <div class="topic__subjectCont__subject">
                <div class="topic__subjectCont__subject__userInfo">
                    <p>{{ subject.user.pseudo }}</p>
                    <div class="topic__subjectCont__subject__userInfo__img"></div>
                </div>
                <div class="topic__subjectCont__subject__content">
                    <div class="topic__subjectCont__subject__content__cont">
                        <p class="topic__subjectCont__subject__content__cont__date">{{ subject.updatedAt|date('d/m/Y à h:i:s') }}</p>
                        {% if app.user and 'ROLE_ADMIN' in app.user.roles %}
                            {% if subject.isLock is same as true %}
                                <a class="topic__subjectCont__subject__content__cont__lockBtn" href="{{ path('admin_lock', {'id' : subject.id}) }}">Débloquer</a>
                            {% else %}    
                                <a class="topic__subjectCont__subject__content__cont__lockBtn" href="{{ path('admin_lock', {'id' : subject.id}) }}">Bloquer</a>
                            {% endif %}
                        {% endif %}
                    </div>
                    <p class="topic__subjectCont__subject__content__text">{{ subject.mainContent|raw }}</p>
                </div>
            </div>
        </section>
        <section class="topic__response">
        {% for response in responses %}
            <article class="topic__response__article">
                <div class="topic__response__article__userInfo">
                    <p>{{ response.user.pseudo }}</p>
                    <div class="topic__subjectCont__subject__userInfo__img"></div>
                </div>
                <div class="topic__response__article__content">
                    <p class="topic__response__article__content__date">{{ response.updatedAt|date('d/m/Y à h:i:s') }}</p>
                    <div class="topic__response__article__content__resp">
                        {{ response.content|raw }}
                    </div>
                    {% if (app.user is not null) and (app.user is same as response.user or 'ROLE_ADMIN' in app.user.roles) %}
                        <div class="topic__response__article__content__userBtn">
                            <button onClick="displayMessageForm({{ loop.index }})">Modifier</button>
                            <a onClick="return confirm('Voulez vous vraiment supprimer ce commentaire ?')" href="{{ path('app_resp_delete', {'id': response.id}) }}"><button>Supprimer</button></a>
                        </div>  
                    {% endif %}
                </div>
            </article>    
        {% endfor %}
        </section>
        <section class="topic__pagination">
            <div class="navigation topic__pagination__nav">
                {{ knp_pagination_render(responses) }}
            </div>
        </section>
        <section class="topic__formSection">
            {% if subject.isLock is same as false %}
                {% if app.user %}
                    {{ form_start(form) }}
                        {{ form_widget(form.content) }}
                        <div class="topic__form__btnCont">
                            {{ form_widget(form.submit) }}
                        </div>
                    {{ form_end(form) }}
                {% else %}
                    <div class="topic__form__closed">
                        <p>Vous devez etre connecter pour poster</p>
                    </div>
                {% endif %}
            {% else %}
                <div class="topic__form__closed">
                    <p>Ce sujet est clôs, vous ne pouvez plus repondre.</p>
                </div>
            {% endif %}
        </section>
    </main>
    <script>
        const displayMessageForm = (repId) => {
            const message = document.querySelector('.message__form' + repId);
            if(message.classList.contains('message__form--hidden')) {
                message.classList.remove('message__form--hidden');
            } else {
                message.classList.add('message__form--hidden');
            }
        }
    </script>
{% endblock %}