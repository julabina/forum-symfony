{% extends "base.html.twig" %}

{% block title %}Forum - {{ subject.title }}{% endblock %}

{% block body %}
    <style>
        .message__form--hidden {
            display:none;
        }
    </style>
    <main>
        <h1>{{ subject.title }}</h1>
        {% if subject.subTitle %}
            <h2>{{ subject.subTitle }}</h2>
        {% endif %}
        <p><a href="{{ path('app_home') }}">Accueil</a> > <a href="{{ path('app_forum_list') }}">Forum</a> > <a href="{{ path('app_cat_show', { 'id': catId }) }}">{{ catTitle }}</a> > <a href="{{ path('app_sub_show', { 'catId': catId, 'id': subId }) }}">{{ subTitle }}</a> > {{ subject.title }}</p>
        <div class="navigation">
            {{ knp_pagination_render(responses) }}
        </div>
        <section style="border:4px solid black; padding:15px;width: 800px;">
            <p>{{ subject.mainContent|raw }}</p>
            <div style="display:flex;justify-content:space-between;">
                <p>{{ subject.updatedAt|date('d/m/Y à h:i:s') }}</p>
                <p>{{ subject.user.pseudo }}</p>
            </div>
        </section>
        <section>
        {% for response in responses %}
            <article style="border:1px solid black; padding:15px;width: 800px;">
                <div>
                    {{ response.content|raw }}
                </div>
                <div style="display:flex;justify-content:space-between;">
                    <p>{{ response.updatedAt|date('d/m/Y à h:i:s') }}</p>
                    <p>{{ response.user.pseudo }}</p>
                </div>
                {% if app.user is same as response.user %}
                    <div>
                        <button onClick="displayMessageForm({{ loop.index }})">Modifier</button>
                        <a href=""><button>Supprimer</button></a>
                    </div>  
                    <div class="message__form{{ loop.index }} message__form--hidden">
                        {# {{ form(form[loop.index]) }} #}
                    </div>
                {% endif %}
            </article>    
        {% endfor %}
        <div class="navigation">
            {{ knp_pagination_render(responses) }}
        </div>
        </section>
        <section>
            {% if subject.isLock is same as false %}
                {% if app.user %}
                    {{ form(form) }}
                {% else %}
                    <div class="" style="width: 800px;text-align:center;padding: 40px 0;border:2px solid black;">
                        <p>Vous devez etre connecter pour poster</p>
                    </div>
                {% endif %}
            {% else %}
                <p>Ce sujet est clôs, vous ne pouvez plus repondre.</p>
            {% endif %}
        </section>
    </main>
    <script>
        const displayMessageForm = (repId) => {
            const message = document.querySelector('.message__form' + repId);
            if(message.classList.contains('message__form--hidden')) {
                message.classList.remove('message__form--hidden');
            } else {
                message.classList.add('message__form--hidden');
            }
        }
    </script>
{% endblock %}